<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="com.javalec.ex.Dao.PayDao">
	
	<!-- 회원 장바구니 보기 -->
	<select id="cart_view" resultType="com.javalec.ex.Dto.PayDto.CartDto">
		select cart.cart_code, product.p_code, product.p_name, product.p_category, product.price, product.p_point, cart.amount 
		from cart, product
		where cart.id='test4' and cart.p_code=product.p_code
	</select>
	
	<!-- 장바구니에서 주문페이지로 제품 넘기기-->
	<select id="go_order" resultType="com.javalec.ex.Dto.PayDto.CartDto">
		select cart.cart_code, product.p_code, product.p_name, product.p_category, product.price, product.p_point, cart.amount 
		from cart, product
		where cart.id='test4' and cart.cart_code=#{param1} and cart.p_code=product.p_code
	</select>
	
	<!-- 주문페이지 주문서 작성 -->
	<insert id="make_order">
		insert into payment values(to_char(sysdate,'yyyyMMdd')||-payment_seq.nextval,
		#{param1},'-',#{param2},'0','N',sysdate,#{param3},
		'결제대기','-','-','-')
	</insert>
	
	
	
	<!-- 포인트 적립 리스트,총액 가져오기 -->
	<select id="point_list" resultType="com.javalec.ex.Dto.PayDto.PointDto">
		select * from point where id=#{param1} order by po_date desc 
	</select>
	<select id="point_sum" resultType="int">
		select sum(po_point) from point where id=#{param1}
	</select>
	
	<!-- 포인트 사용 리스트,총액 가져오기 -->
	<select id="upoint_list" resultType="com.javalec.ex.Dto.PayDto.Use_pointDto">
		select * from use_point where id=#{param1} order by u_date desc
	</select>
	<select id="upoint_sum" resultType="int">
		select sum(u_point) from use_point where id=#{param1}
	</select>
	<!-- 사용가능포인트-->
	<select id="usable_point" resultType="int">
		select pointsum-upointsum from (select sum(po_point) as pointsum from point where id=#{param1}),
		(select sum(u_point) as upointsum from use_point where id=#{param1})
	</select>

</mapper>